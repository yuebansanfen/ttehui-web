<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
		<meta charset="utf-8" />
		<title>新增商品-商品管理-${baseDescribe}</title>
		<meta name="keywords" content="新增商品" />
		<meta name="description" content="新增商品" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		#parse("commons/commonCss.vm")
		<link type="text/css" rel="stylesheet" href="${base}/plugin/area/css/default/zyzn.css" />
        <link type="text/css" rel="stylesheet" href="${base}/plugin/kindeditor/themes/default/default.css" />
		#parse("commons/commonJs.vm")
	</head>

	<body class="no-skin">
		#parse("commons/header.vm")
		<div class="main-container" id="main-container">
			<script type="text/javascript">
				try{ace.settings.check('main-container' , 'fixed')}catch(e){}
			</script>

			<div class="main-container-inner">

				#parse("commons/sidebar.vm")
				<div class="main-content">
					
					#parse("commons/breadcrumbs.vm")
					<div class="page-content">
						
						#parse("commons/setting.vm")
						<div class="page-header">
							<h1>
                                                                                        新增商品
                                #parse("commons/backurl.vm")
							</h1>
						</div><!-- /.page-header -->
						
						<div class="row">
							<div class="col-xs-12">
								<!-- PAGE CONTENT BEGINS -->
                                <div class="widget-body">
                                    <div class="widget-main">
                                        <div id="fuelux-wizard-container" class="">
                                            <div>
                                                <ul class="steps">
                                                    <li data-step="1" class="active"><span class="step">1</span>
                                                        <span class="title">商品基本信息</span></li>

                                                    <li data-step="2" class=""><span class="step">2</span>
                                                        <span class="title">商品属性及库存</span></li>

                                                    <li data-step="3" class=""><span class="step">3</span>
                                                        <span class="title">商品详情</span></li>

                                                    <li data-step="4" class=""><span class="step">4</span>
                                                        <span class="title">商品参数</span></li>

                                                    <li data-step="5" class=""><span class="step">5</span>
                                                        <span class="title">分享信息</span></li>
                                                </ul>
                                            </div>
                                            <hr>
                                            <div class="step-content pos-rel">
                                                <div class="step-pane active" data-step="1" id="baseInfo">
                                                    <form id="baseInfoForm" name="baseInfoForm" class="form-horizontal">
                                                    	<input type="hidden" id="goods_id" name="goodsId" value="" />
                                                        <div class="form-group">
                                                            <label class="col-sm-2 control-label no-padding-right" ><span class="middle red">*</span>商品名称： </label>
                                                            <div class="col-sm-9">
                                                                <div class="clearfix">
                                                                    <input type="text" id="title" name="title" placeholder="商品名称" class="col-xs-10 col-sm-5"/>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="form-group">
                                                            <label class="col-sm-2 control-label no-padding-right" >商品简介： </label>
                                                            <div class="col-sm-9">
                                                                <div class="clearfix">
                                                                    <textarea  id="describe" name="describe" placeholder="商品简介" class="col-xs-10 col-sm-5"></textarea>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="form-group">
                                                            <label class="col-sm-2 control-label no-padding-right" >是否限制购买 ：</label>
                                                            <div class="col-sm-9">
                                                                <div class="clearfix">
                                                                	<div class="col-sm-2">
                                                                	<input type="checkbox" class="ace" id="isLimitBuy" />
                                                                	<span class="lbl"> 限制</span>
                                                                	</div>
                                                                    <input type="text" class="col-xs-6 col-sm-3" id="limitNums" name="limitNums" placeholder="最大购买数量" />
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="form-group">
                                                            <label class="col-sm-2 control-label no-padding-right" >天猫价：</label>
                                                            <div class="col-sm-9">
                                                                <div class="clearfix">
                                                                    <input type="text" id="tmPrice" name="tmPrice" placeholder="天猫价" class="col-xs-10 col-sm-5"/>
                                                                    <span class="help-inline col-xs-12 col-sm-7"><span class="middle">注：页面展示用，可以是一个区间值，单位为元</span></span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="form-group">
                                                            <label class="col-sm-2 control-label no-padding-right" >京东价：</label>
                                                            <div class="col-sm-9">
                                                                <div class="clearfix">
                                                                    <input type="text" id="jdPrice" name="jdPrice" placeholder="京东价" class="col-xs-10 col-sm-5"/>
                                                                    <span class="help-inline col-xs-12 col-sm-7"><span class="middle">注：页面展示用，可以是一个区间值，单位为元</span></span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="form-group">
                                                            <label class="col-sm-2 control-label no-padding-right" >积分： </label>
                                                            <div class="col-sm-9">
                                                                <div class="clearfix">
                                                                    <input type="text" id="score" name="score" placeholder="积分" class="col-xs-10 col-sm-5"/>
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <div class="form-group">
                                                            <label class="col-sm-2 control-label no-padding-right" >在店铺中的排序：</label>
                                                            <div class="col-sm-9">
                                                                <div class="clearfix">
                                                                    <input type="text" id="shopSorting" name="shopSorting" placeholder="在店铺中的排序（1-10）" class="col-xs-10 col-sm-5"/>
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <div class="form-group">
                                                            <label class="col-sm-2 control-label no-padding-right" ><span class="middle red">*</span>商品分类： </label>
                                                            <div class="col-sm-9">
                                                                <select class="chosen-select col-sm-5" id="select_category" name="selectCategory" data-placeholder="商品分类"></select>
                                                            </div>
                                                        </div>

                                                        <div class="form-group">
                                                            <label class="col-sm-2 control-label no-padding-right" >投放城市：</label>
                                                            <div class="col-sm-9">
                                                                <div class="clearfix">
																	  <input type='text' class="col-xs-10 col-sm-5" id="put_areas" readonly="readonly" value='请选择城市' data-value="" onclick="appendCity(this,'duoxuan')">
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <div class="form-group">
                                                            <label class="col-sm-2 control-label no-padding-right" >运费标准： </label>
                                                            <div class="col-sm-9">
                                                                <div class="clearfix">
                                                                    <select style="width: 200px" id="select_freightMould" name="state" class="select2" data-placeholder="运费"></select>
                                                                </div>
                                                            </div>
                                                        </div>

														<div class="form-group">
															<label class="col-sm-2 control-label no-padding-right" for="form-field-2"><span class="middle red">*</span>列表展示页商品图： </label>
															<div class="col-sm-9">
																<div class="clearfix">
																	<input class="col-xs-10 col-sm-5" name="imgListPage" id="imgListPage" type="text" readonly="readonly"/>
																	<span class="help-inline col-xs-12 col-sm-7">
																		<span class="middle"><a class="btn btn-minier btn-primary" onclick="addImg('imgListPage');">添加</a></span>
																		<span class="middle">注：图片尺寸228*228</span>
																	</span>
																</div>
															</div>
														</div>

														<div class="form-group">
															<label class="col-sm-2 control-label no-padding-right" for="form-field-2"><span class="middle red">*</span>购物车展示图： </label>
															<div class="col-sm-9">
																<div class="clearfix">
																	<input class="col-xs-10 col-sm-5" name="imgCart" id="imgCart" type="text" readonly="readonly"/>
																	<span class="help-inline col-xs-12 col-sm-7">
																		<span class="middle"><a class="btn btn-minier btn-primary" onclick="addImg('imgCart');">添加</a></span>
																		<span class="middle">注：图片尺寸228*228</span>
																	</span>
																</div>
															</div>
														</div>
                                                    </form>
                                                </div>

                                                <div class="step-pane price" data-step="2" style="text-align:center">
                                                    <form class="form-horizontal">
                                                        <div class="form-group">
	                                                        <label class="col-sm-2 control-label no-padding-right"><span class="middle red">*</span>商品属性：</label>
															<div class="col-sm-10">
																<table id="attr_table" width="100%" class="table table-striped table-bordered table-hover">
											                    <thead>
											                    	<tr>
											                    		<th width="10%">#</th>
											                    		<th width="40%">属性名</th>
											                    		<th width="40%">属性值</th>
											                    		<th width="10%">操作</th>
											                    	</tr>
											                    </thead>
											                    <tbody>
											                    	<tr>
											                    		<th>1</th>
											                    		<th>
											                    			<select class="chosen-select form-control" id="attr_1" name="attr1">
											                    			</select>
											                    		</th>
											                    		<th>
											                    			<div class="clearfix">
																				<input class="col-xs-10 col-sm-10" name="actName" id="actName" type="text" />
																			</div>
											                    		</th>
											                    		<th>
											                    			<a class="btn btn-xs btn-yellow btn_addAttrVal">添加属性值</a>
											                    		</th>
											                    	</tr>
											                    </tbody>
										                   		</table>
															</div>
                                                        </div>
														<div class="form-group">
															<div class="clearfix align-center">
																<button id="btn_addAttri" class="btn btn-xs btn-yellow" type="button">
																	添加一个新属性
																</button>
																<button id="btn_createTable" class="btn btn-xs btn-success" type="button">
																	生成价格库存表
																</button>
															</div>
														</div>
                                                        <div class="form-group">
                                                            <label class="col-sm-2 control-label no-padding-right"><span class="middle red">*</span>库存价格：</label>
                                                            <div class="col-sm-10">
                                                                <table width="100%" id="sku_table" class="table table-striped table-bordered table-hover">
                                                                    <thead>
	                                                                    <tr>
	                                                                        <th width="5%">#</th>
	                                                                        <th width="35%">属性描述</th>
	                                                                        <th width="20%">库存</th>
	                                                                        <th width="20%">售价</th>
	                                                                        <th width="20%">原价</th>
	                                                                    </tr>
                                                                    </thead>
                                                                    <tbody>
                                                                    	<tr><th colspan="5">请先生成价格库存表</th></tr>
                                                                    </tbody>
                                                                </table>
                                                            </div>
                                                        </div>
                                                    </form>
                                                </div>
                                                <div class="step-pane" data-step="3">
                                                    <form class="form-horizontal">
                                                        <div class="form-group">
															<label class="col-sm-2 control-label no-padding-right" for="form-field-2"><span class="middle red">*</span>详细页顶部banner： </label>
															<div class="col-sm-8" id="banners_div">
																<div class="clearfix">
																	<input class="col-xs-10 col-sm-5" name="imgBanner" id="imgBanner" type="text" readonly="readonly"/>
																	<span class="help-inline col-sm-2 middle"><a class="btn btn-minier btn-primary" onclick="addImg('imgBanner');">添加</a></span>
																	<span class="help-inline col-sm-3 middle"><a class="btn btn-sm btn-primary" onclick="addImgBan();">新增多张展示图</a></span>
																</div>
                                                        <img id="imgBanner_preview" class="hidden" src="" style="height: 100px;width: 100px">
															</div>
														</div>

                                                        <div class="form-group">
                                                            <label class="col-sm-2 control-label no-padding-right" >图文详细页内容：</label>
                                                            <div class="col-sm-9">
                                                                <div class="clearfix">
                                                                    <textarea id="details" name="content" style="width:700px;height:300px;"></textarea>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </form>
                                                </div>
                                                <div class="step-pane" data-step="4" >
                                                    <form class="form-horizontal" >
                                                        <div class="form-group">
	                                                        <label class="col-sm-2 control-label no-padding-right"><span class="middle red">*</span>商品参数：</label>
															<div class="col-sm-10">
																<table id="param_table" width="100%" class="table table-striped table-bordered table-hover">
											                    <thead>
											                    	<tr>
											                    		<th width="10%">#</th>
											                    		<th width="40%">参数名</th>
											                    		<th width="40%">参数值</th>
											                    		<th width="10%">操作</th>
											                    	</tr>
											                    </thead>
											                    <tbody>
											                    	<tr>
											                    		<th>1</th>
											                    		<th>
											                    			<div class="clearfix">
																				<input class="col-xs-10 col-sm-10" id="param_name_1" name="paramName1" type="text" />
																			</div>
											                    		</th>
											                    		<th>
											                    			<div class="clearfix">
																				<input class="col-xs-10 col-sm-10" name="paramVal1" id="param_Val1" type="text" />
																			</div>
											                    		</th>
											                    		<th>
											                    			<a class="btn btn-xs btn-yellow" id="btn_addParam">添加商品参数</a>
											                    		</th>
											                    	</tr>
											                    </tbody>
										                   		</table>
															</div>
                                                        </div>
                                                    </form>
                                                </div>
                                                <div class="step-pane" data-step="5">
                                                    <form class="form-horizontal" id="shareFrom" role="form">
                                                    	<div class="form-group">
                                                            <label class="col-sm-2 control-label no-padding-right" >分享标题： </label>
                                                            <div class="col-sm-9">
                                                                <div class="clearfix">
                                                                    <input type="text" id="share_title" name="shareTitle" placeholder="分享标题" class="col-xs-10 col-sm-5"/>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="form-group">
                                                            <label class="col-sm-2 control-label no-padding-right" >分享描述： </label>
                                                            <div class="col-sm-9">
                                                                <div class="clearfix">
                                                                	<input type="text" id="share_description" name="shareDescription" placeholder="分享描述" class="col-xs-10 col-sm-5"/>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    	<div class="form-group">
															<label class="col-sm-2 control-label no-padding-right" for="form-field-2">分享图片： </label>
															<div class="col-sm-8">
																<div class="clearfix">
																	<input class="col-xs-10 col-sm-5" name="sharePic" id="share_pic" type="text" readonly="readonly"/>
																	<span class="help-inline col-sm-1"><span class="middle"><a class="btn btn-minier btn-primary" onclick="addImg('share_pic');">添加</a></span></span>
																</div>
                                                        <img id="share_pic_preview" class="hidden" src="" style="height: 100px;width: 100px">
															</div>
														</div>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                        <hr>
                                        <div class="wizard-actions">
                                            <button class="btn btn-prev">
                                                <i class="ace-icon fa fa-arrow-left"></i>上一步
                                            </button>
                                            <button class="btn btn-success btn-next" data-last="保存" >
												 保存，下一步 <i class="ace-icon fa fa-arrow-right icon-on-right"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <!-- /.widget-main -->
                                </div>
								<!-- PAGE CONTENT ENDS -->
							</div><!-- /.col -->
						</div><!-- /.row -->
					</div><!-- /.page-content -->
				</div><!-- /.main-content -->

			</div><!-- /.main-container-inner -->

			#parse("commons/scroll.vm")
		</div><!-- /.main-container -->

		#parse("commons/footerJs.vm")
        <script src="${base}/mocentre/js/fuelux/fuelux.wizard.js"></script>
        <script src="${base}/mocentre/js/ace/elements.wizard.js"></script>
        <script src="${base}/mocentre/js/common.js"></script>
		<script>
			var __LocalDataCities = {};
			__LocalDataCities.list = {};
			__LocalDataCities.relations = {};
			__LocalDataCities.category = {};
            var attrData = [];
            var editor;
            KindEditor.ready(function(K){
                editor = K.create('#details',{
                    resizeType: 1,
		            allowFileManager: true,
		            allowImageUpload: false,
		            items : [
		             		'source', '|', 'undo', 'redo', '|', 'preview', 'print', 'template', 'code', 'cut', 'copy', 'paste',
		             		'plainpaste', 'wordpaste', '|', 'justifyleft', 'justifycenter', 'justifyright',
		             		'justifyfull', 'insertorderedlist', 'insertunorderedlist', 'indent', 'outdent', 'subscript',
		             		'superscript', 'clearhtml', 'quickformat', 'selectall', '|', 'fullscreen', '/',
		             		'formatblock', 'fontname', 'fontsize', '|', 'forecolor', 'hilitecolor', 'bold',
		             		'italic', 'underline', 'strikethrough', 'lineheight', 'removeformat', '|', 'image', 
		             		'flash', 'media', 'insertfile', 'table', 'hr', 'emoticons', 'baidumap', 'pagebreak',
		             		'anchor', 'link', 'unlink', '|'
		             	],
		            uploadCallback: addImg
                });
            });
            
            $(document).ready(function(){
            	$.ajax({
                    type:"post",
                    url:'${base}/goods/goods/ajax/areas.htm',
                    dataType:"JSON",
                    success:function(result){
                        if(result.success == true) {
                        	var dataStr = result.data;
                        	if(dataStr!=null){
                        		var provArr = JSON.parse(dataStr);
        						__LocalDataCities.category["provinces"] = [];
        						__LocalDataCities.category["hotcities"] = [];
                        		$.each(provArr,function(n,prov){
	                    			__LocalDataCities.list[prov.code] = [prov.name,prov.code];
            						__LocalDataCities.relations[prov.code] = [];
            						if(prov.name!='北京市'&&prov.name!='天津市'&&prov.name!='上海市'){
            							__LocalDataCities.category["provinces"].push(prov.code);
            						}
                    				var cityArr = prov.childrenList;
                    				if(cityArr!=null){
                    					$.each(cityArr,function(m,city){
                							__LocalDataCities.list[city.code] = [city.name,city.code];
                    						__LocalDataCities.relations[prov.code].push(city.code);
                    						if(city.name=='北京'||city.name=='上海'||city.name=='广州'||city.name=='深圳'||
                    							city.name=='天津'||city.name=='苏州'||city.name=='重庆'||city.name=='南京'||
                    							city.name=='杭州'||city.name=='大连'||city.name=='成都'||city.name=='武汉'){
	                    						__LocalDataCities.category["hotcities"].push(city.code);
                    						}
                    					});
                    				}
                        		})
                        	}
                        }
                    }
                });
            	$.ajax({
                    type:"post",
                    url:'${base}/goods/goods/ajax/category.htm',
                    dataType:"json",
                    success:function(result){
                    	var data = result;
                    	if(data!=null){
                        	for (var i in data) {
		                        var oOption = $("<option value=\""+data[i].id+"\">"+data[i].name+"</option>");
		                        $("#select_category").append(oOption);
		                    }
                    	}
                        $('#select_category').chosen({no_results_text:"未找到此选项：",allow_single_deselect:true});
                    }
                });
                $.ajax({
                    type:"post",
                    url:"${base}/fee/freightmould/query.htm",
                    dataType:"json",
                    success:function(data){
                        if(data != null  && data != ""){
                            append_select_option($("#select_freightMould"),data.data);
                        }
                    }
                });
                $.ajax({
                    type:"post",
                    url:"${base}/goods/goods/ajax/attribute.htm",
                    dataType:"json",
                    success:function(result){
                        attrData = result;
	                    for (var i in result) {
	                        var oOption = $("<option value=\""+result[i].id+"\" code=\""+result[i].code+"\">"+result[i].name+"</option>");
	                        $("#attr_1").append(oOption);
	                    }
                    }
                });
            	
            	//商品基本信息
            	var rules = {},messages = {};
				rules.title = {required:true};
				rules.score = {digits:true};
				rules.limitNums = {digits:true};
				rules.shopSorting = {digits:true};
				rules.selectCategory = {required:true};
				messages.title = {required:"名称不能为空"};
				messages.score = {digits:"必须输入整数"};
				messages.limitNums = {digits:"必须输入整数"};
				messages.shopSorting = {digits:"必须输入整数"};
				messages.selectCategory = {required:"商品分类不能为空"};
				Validate.init("baseInfoForm",rules,messages,
					function(form){
						if($("#imgListPage").val()==""||$("#imgCart").val()==""){
							return;
						}
						commitBaseInfo();
					}
				);
            
                $('#fuelux-wizard-container').ace_wizard({
                }).on('actionclicked.fu.wizard',function(e, info) {
                	var step=info.step;
                	var direction=info.direction;//next,previous
                    if(step==1&&direction=='next'){
                    	if(!$("#baseInfoForm").valid()){
                    		e.preventDefault();
                    		return;
                    	};
						if($("#imgListPage").val()==""){
							layer.msg("请上传列表展示页商品图");
							e.preventDefault();
							return;
						}
						if($("#imgCart").val()==""){
							layer.msg("请上传购物车展示图");
							e.preventDefault();
							return;
						}
						$("#baseInfoForm").submit();
                    }else if(step==2&&direction=='next'){
                    	var storageData = getStorageData();
                    	if(storageData.length==0){
                    		layer.msg("请生成库存价格");
                    		e.preventDefault();
                    		return;
                    	}
                    	commitSkuInfo(storageData);
                    }else if(step==3&&direction=='next'){
                    	var inputDom = $("#banners_div > .clearfix > input");
                    	var domPass=false;
                    	inputDom.each(function(i,dom){
	                    	if($(dom).val()==""){
								domPass=true;
							}
                    	})
                    	if(domPass){
                    		layer.msg("请上传展示图片");
                    		e.preventDefault();
							return;
                    	}
                        commitDetailInfo();
                    } else if(step==4&&direction=='next'){
                    	commitParamInfo();
                    }
                }).on('finished.fu.wizard',function(e) {
                        commitShareInfo();
                }).on('stepclick.fu.wizard', function(e) {
                        e.preventDefault();
                });
            });
            
			/**
             * 单击添加一个属性值按钮
             */
            $(document).on("click",".btn_addAttrVal",function(){
            	var attrValThDom = $(this).parent().prev();
            	var attrVal ="<div class=\"space-2\"></div>";
            	attrVal+="<div class=\"clearfix\">";
				attrVal+="<input class=\"col-xs-10 col-sm-10\" name=\"actName\" id=\"actName\" type=\"text\" />"
				attrVal+="<span class=\"help-inline col-xs-2 col-sm-2 middle\"><a class=\"ace-icon glyphicon glyphicon-trash red del-attrValue\" href=\"javascript:void(0)\"></a></span>";
				attrVal+="</div>";
				attrValThDom.append(attrVal);
            })
            
            /**
             * 单击删除一个属性值按钮
             */
            $(document).on("click",".del-attrValue",function(){
            	var clearDom = $(this).parents(".clearfix");
                clearDom.prev().remove();
                clearDom.remove();
                clearTbody();
            })
            
            /**
             * 单击添加一个属性按钮
             */
            $(document).on("click","#btn_addAttri",function(){
            	if(attrData.length==0){
            		layer.msg("无属性名，不能添加");
            		return;
            	}
                var tbodyDom = $("#attr_table > tbody");
            	var tbodyTrLen = tbodyDom.children("tr").length;
            	if(tbodyTrLen==3){
            		layer.msg("最多添加三个属性");
            		return;
            	}
            	var attrOpt = [];
            	for (var i in attrData) {
                    attrOpt.push("<option value="+attrData[i].id+" code="+attrData[i].code+">"+attrData[i].name+"</option>");
                }
                var times = new Date().getTime();
            	var thHtm = [];
            	thHtm.push("<tr>");
            	thHtm.push("<th>"+(tbodyTrLen+1)+"</th>");
            	thHtm.push("<th><select class=\"chosen-select form-control\" id=\"attr_"+tbodyTrLen+"\" name=\"attr"+tbodyTrLen+"\">"+attrOpt.join("")+"</select></th>");
            	thHtm.push("<th><div class=\"clearfix\"><input class=\"col-xs-10 col-sm-10\" name=\"attrName"+tbodyTrLen+"\" id=\"attrName_"+tbodyTrLen+"\" type=\"text\" /></div></th>");
            	thHtm.push("<th><a class=\"btn btn-xs btn-danger btn-delAttr\" id=\"btn_delAttr_"+tbodyTrLen+"\">删除</a><div class=\"space-2\"></div><a class=\"btn btn-xs btn-yellow btn_addAttrVal\">添加属性值</a></th>");
            	thHtm.push("</tr>");
				tbodyDom.append(thHtm.join(""));            
            })
            
            /**
             * 单击删除一个属性按钮
             */
            $(document).on("click",".btn-delAttr",function(){
            	$(this).parents("tr").remove();
            	clearTbody();
            	//var delObj = $(this);
            	//Box.confirm("确认删除?",function(delObj){
	            //    $(delObj).parents("tr").remove();
				//});
            })
            
            /**
             * 单击添加商品参数
             */
            $(document).on("click","#btn_addParam",function(){
            	var tbodyDom = $("#param_table > tbody");
            	var tbodyTrLen = tbodyDom.children("tr").length+1;
            	var times = new Date().getTime();
            	var thHtm = [];
            	thHtm.push("<tr>");
            	thHtm.push("<th>"+tbodyTrLen+"</th>");
            	thHtm.push("<th><div class=\"clearfix\"><input class=\"col-xs-10 col-sm-10\" name=\"paramName"+times+"\" id=\"param_name_"+times+"\" type=\"text\" /></div></th>");
            	thHtm.push("<th><div class=\"clearfix\"><input class=\"col-xs-10 col-sm-10\" name=\"paramVal\" id=\"param_val_"+times+"\" type=\"text\" /></div></th>");
            	thHtm.push("<th><a class=\"btn btn-xs btn-yellow btn-delParam\" id=\"btn_delParam_"+times+"\">删除</a><div class=\"space-2\"></div></th>");
            	thHtm.push("</tr>");
				tbodyDom.append(thHtm.join("")); 
            })
            
            /**
             * 单击删除商品参数按钮
             */
            $(document).on("click",".btn-delParam",function(){
            	$(this).parents("tr").remove();
            })
            
            /**
             * 单击生成价格库存表按钮，生成价格库存表
             */
            $(document).on("click","#btn_createTable",function(){
                var tbodyDom = $("#sku_table > tbody");
                tbodyDom.empty();
                var allAttrNameList = [], allAttrCodeList = [];
                var tableNameList = [], tableCodeList = [];
                var tableTrList = getAttrTableData();
                for(var i=0;i<tableTrList.length;i++){
                    var attrCodeList = [],attrNameList = [];
                    var attrValList =  tableTrList[i].attrVal;
                    var attrCode = tableTrList[i].attrCode;
                    var attrName = tableTrList[i].attrName;
                    for(var ii=0;ii<attrValList.length;ii++){
                        attrCodeList.push(attrCode+ii);
                        attrNameList.push(attrName+":"+attrValList[ii]);
                    }
                    allAttrCodeList.push(attrCodeList);
                    allAttrNameList.push(attrNameList);
                }
                var allAttrCodeListLen = allAttrCodeList.length;
                if(allAttrCodeListLen==1){
                    for(var i=0;i<allAttrCodeList[0].length;i++){
                        tableCodeList.push(allAttrCodeList[0][i]);
                        tableNameList.push(allAttrNameList[0][i]);
                    }
                }else if(allAttrCodeListLen==2){
                    for(var i=0;i<allAttrCodeList[0].length;i++){
                        for(var j=0;j<allAttrCodeList[1].length;j++){
                            tableCodeList.push(allAttrCodeList[0][i]+"-"+allAttrCodeList[1][j]);
                            tableNameList.push(allAttrNameList[0][i]+"-"+allAttrNameList[1][j]);
                        }
                    }
                }else if(allAttrCodeListLen==3){
                    for(var i=0;i<allAttrCodeList[0].length;i++){
                        for(var j=0;j<allAttrCodeList[1].length;j++){
                            for(var k=0;k<allAttrCodeList[2].length;k++){
                                tableCodeList.push(allAttrCodeList[0][i]+"-"+allAttrCodeList[1][j]+"-"+allAttrCodeList[2][k]);
                                tableNameList.push(allAttrNameList[0][i]+"-"+allAttrNameList[1][j]+"-"+allAttrNameList[2][k]);
                            }
                        }
                    }
                }
                var bodyTrHtm = [];
                for(var i= 0;i<tableCodeList.length;i++){
                    bodyTrHtm.push("<tr>");
                    bodyTrHtm.push("<th>"+(i+1)+"</th>");
                    bodyTrHtm.push("<th code="+tableCodeList[i]+">"+tableNameList[i]+"</th>");
                    //bodyTrHtm.push("<th>"+tableCodeList[i]+"</th>");
                    bodyTrHtm.push("<th><input class=\"col-xs-10 col-sm-10\" type=\"text\"/></th>");
                    bodyTrHtm.push("<th><input class=\"col-xs-10 col-sm-10\" type=\"text\"/>元</th>");
                    bodyTrHtm.push("<th><input class=\"col-xs-10 col-sm-10\" type=\"text\"/>元</th>");
                    bodyTrHtm.push("</tr>");
                }
                tbodyDom.append(bodyTrHtm.join(""));
            })

            function addImg(nodeId){
				var index = layer.open({
				  type: 2,
				  title: "上传图片",
				  shadeClose: true,
				  closeBtn: 1,
				  area: ['30%', '50%'],
				  content: ['${base}/common/upyun/uploadImg.htm?nodeId='+nodeId, 'no'],
				  btn: ['关闭'],
                    yes:function(){
                        layer.close(index);
                    }
				});
			}
			
			function clearTbody(){
				var tbodyDom = $("#sku_table > tbody");
				tbodyDom.empty();
				tbodyDom.append($("<tr><th colspan=\"5\">请先生成价格库存表</th></tr>"))
			}


            /**
             * 获取checkbox的值
             */
            function getCheckboxVal(o){
                if(o.is(':checked')){
                    return 1;
                }else {
                    return 0;
                }
            }

            /**
             * 提交商品库存价格信息
             */
            function commitSkuInfo(storageData){
                var paramMap = {}
                paramMap.goodsId = $("#goods_id").val();
                paramMap.standard = getStandard();
                paramMap.goodsStorageList = storageData;
                $.ajax({
                    type:"post",
                    url:"${base}/goods/goods/addOrUpdateSkuInfo.htm",
                    data:{"paramMap":JSON.stringify(paramMap)},
                    success:function(data){
                        if(data.success){
                            layer.msg("操作成功");
                        }
                    },
                    error: function(){
                    	layer.msg("系统异常");
                    }
                })
            }

            /**
             * 提交产品参数信息
             */
            function commitParamInfo(){
                var paramMap = {};
                var paramDataList = getParamData();
                paramMap.goodsId = $("#goods_id").val();
                paramMap.paramList= paramDataList;
                $.ajax({
                    type:"post",
                    url:"${base}/goods/goods/addOrUpdateParamInfo.htm",
                    data:{"paramMap":JSON.stringify(paramMap)},
                    success:function(data){
                        layer.msg("操作成功");
                    }
                })
            };

            /**
             * 提交商品基本信息
             */
            function commitBaseInfo(){
                var paramMap = {};
                paramMap.id = $("#goods_id").val();
                paramMap.title = $("#title").val();
                paramMap.describe = $("#describe").val();
                paramMap.sellPrice = $("#sellPrice").val();
                paramMap.oldPrice = $("#oldPrice").val();
                paramMap.tmPrice = $("#tmPrice").val();
                paramMap.jdPrice = $("#jdPrice").val();
                paramMap.isLimitBuy = getCheckboxVal($("#isLimitBuy"));
                if(getCheckboxVal($("#isLimitBuy")) == 1){
                    paramMap.limitNums = $("#limitNums").val();
                }
                paramMap.score = $("#score").val();
                paramMap.status = "toAudit";
                paramMap.shopSorting = $("#shopSorting").val();
                paramMap.categoryId = $("#select_category").val();
                paramMap.areaList = $("#put_areas").data("value");
                paramMap.freightMould = $("#select_freightMould").val();
                paramMap.imgListPage =  $("#imgListPage").val();
                paramMap.imgCart = $("#imgCart").val();
                $.ajax({
                    async:false,
                    type:"post",
                    url:"${base}/goods/goods/addOrUpdateBaseInfo.htm",
                    data:{"paramMap":JSON.stringify(paramMap)},
                    success:function(result){
                        var id = result.data;
                        if(id!=undefined&&id!=""){
                        	$("#goods_id").val(id);
                            layer.msg("操作成功");
                        }
                    },
                    error:function(){
                    	layer.msg("操作失败");
                    }
                })
            }

            /**
             * 提交商品分享信息
             */
            function commitShareInfo(){
                var paramMap = {};
                paramMap.goodsId = $("#goods_id").val();
                paramMap.title = $("#share_title").val();
                paramMap.description = $("#share_description").val();
                paramMap.sharePic = $("#share_pic").val();
                $.ajax({
                    async:"false",
                    type:"post",
                    url:"${base}/goods/goods/addOrUpdateShareInfo.htm",
                    data:{"paramMap":JSON.stringify(paramMap)},
                    success:function(data){
                        layer.msg("操作成功");
                        window.location.href="${base}/goods/goods/index.htm";
                    },
                    error:function(){
                    	layer.msg("操作失败");
                    }
                })
            }

            /**
             * 提交商品详情信息
             */
            function commitDetailInfo(){
                var paramMap= {};
                paramMap.imgBanner = [];
                var inputDom = $("#banners_div > .clearfix > input");
            	inputDom.each(function(i,dom){
            		var domVal = $(dom).val();
                	if(domVal!=""){
                		paramMap.imgBanner.push(domVal);
					}
            	})
                paramMap.goodsId = $("#goods_id").val();
                paramMap.details = editor.html();
                $.ajax({
                    async:"false",
                    type:"post",
                    url:"${base}/goods/goods/addOrUpdateDetailInfo.htm",
                    data:{"paramMap":JSON.stringify(paramMap)},
                    success:function(data){
                        layer.msg("操作成功");
                    },
                    error:function(){
                    	layer.msg("操作失败");
                    }
                })
            }
           
            /**
             * strorageTable表格数据
             */
            function getStorageData(){
            	var storageList = [];
            	var attrTbodyTrDom = $("#sku_table > tbody > tr");
            	for(var i=0;i<attrTbodyTrDom.length;i++){
            		var thDom = attrTbodyTrDom.eq(i).find("th");
            		if(thDom.length==5){
	                    var obj = {};
	                    obj.standardCode = thDom.eq(1).attr("code");
	                    obj.describe = thDom.eq(1).html();
	                    obj.stockNum = thDom.eq(2).find("input").val();
	                    obj.salePrice = thDom.eq(3).find("input").val();
	                    obj.oldPrice = thDom.eq(4).find("input").val();
	                    storageList.push(obj);
            		}
                }
                return storageList;
            }

            /**
             * 生成goods表standard字段
             */
            function getStandard(){
            	var attrDataList = getAttrTableData();
            	var standardList = [];
            	for(var i=0;i<attrDataList.length;i++){
            		var attrObj = {};
            		attrObj.name = attrDataList[i].attrName;
            		attrObj.code = attrDataList[i].attrCode;
            		var attrValList = attrDataList[i].attrVal;
            		for(var j=0;j<attrValList.length;j++){
                        attrObj[j] = attrValList[j];
                    }
                    standardList.push(attrObj);
            	}
                return standardList
            }
            
            /**
             * attrTable表格数据
             * tableTrList=[{'attrName':xxx,'attrCode':xxx,'attrVal':[xx,xx]}]
             */
            function getAttrTableData(){
            	var tableTrList = [];
            	var attrTbodyTrDom = $("#attr_table > tbody > tr");
                attrTbodyTrDom.each(function(i){
                	var attrNameValObj = {};
                	var attrName = $(this).find("th").eq(1).find("option:selected").text()
                	var attrCode = $(this).find("th").eq(1).find("option:selected").attr("code");
                	var attrValsDom = $(this).find("th").eq(2).find("input");
                	attrNameValObj.attrName = attrName;
                	attrNameValObj.attrCode = attrCode;
                	attrNameValObj.attrVal = [];
                	attrValsDom.each(function(j){
                		attrNameValObj.attrVal.push($(this).val());
                	});
                	tableTrList[i] = attrNameValObj;
                });
                return tableTrList;
            }
            
            /**
             * paramTable表格数据
             */
            function getParamData(){
            	var paramList = [];
            	var paramTbodyTrDom = $("#param_table > tbody > tr");
            	for(var i=0;i<paramTbodyTrDom.length;i++){
                    var param = {};
            		var thDom = paramTbodyTrDom.eq(i).find("th");
                    param.goodsKey = thDom.eq(1).find("input").val();
                    param.goodsVal = thDom.eq(2).find("input").val();
                    paramList.push(param);
                }
                return paramList;
            }
            
            function addImgBan(){
            	var times= new Date().getTime();
            	var banHtm = [];
            	banHtm.push("<div class=\"space-2\"></div>");
				banHtm.push("<div class=\"clearfix\">");
				banHtm.push("<input class=\"col-xs-10 col-sm-5\" name=\"imgBanner"+times+"\" id=\"imgBanner"+times+"\" type=\"text\" readonly=\"readonly\"/>");
				banHtm.push("<span class=\"help-inline col-sm-3 middle\">");
				banHtm.push("<a class=\"btn btn-minier btn-primary\" onclick=\"addImg('imgBanner"+times+"')\">添加</a>&nbsp;");
				banHtm.push("<a class=\"btn btn-minier btn-danger\" onclick=\"delImg(this)\">删除</a>");
				banHtm.push("</span></div>");
        banHtm.push("<img id=\"imgBanner"+times+"_preview\" class='hidden' src='' style='height: 100px;width: 100px'>");
				$("#banners_div").append(banHtm.join(""));
            }
            
            function delImg(obj){
            	var objp = $(obj).parent().parent();
            	objp.prev().remove()
                objp.next().remove()
            	objp.remove();
            }
            
            /**
             * 拼接select下的option
             * @param oselect
             * @param optList
             */
            function append_select_option(oselect, optList) {
                if (optList.length != 0) {
                    for (var i in optList) {
                        var oOption = $(' <option value='+optList[i].id+' code='+optList[i].code+'>' + optList[i].name + '</option>');
                        oselect.append(oOption);
                    }
                }
            }

        </script>
        <script src="${base}/plugin/area/js/areadata.js"></script>
</body>
</html>
